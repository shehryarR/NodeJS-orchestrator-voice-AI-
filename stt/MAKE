# stt/Makefile

PYTHON = python
SETUP_SCRIPT = setup_model.py
CHECKPOINT_DIR = checkpoints/stt-1b-en_fr
TEST_WAV = audio/moshi_speech_test.wav  # replace with a real test file

.PHONY: all npm-install install setup clean test

# Default target
all: npm-install setup

# Install Node.js dependencies
npm-install:
	@echo "Installing Node.js dependencies..."
	npm install

# Install Python dependencies and setup model
install:
	@echo "Installing Python dependencies and STT model..."
	$(PYTHON) -m pip install --upgrade pip
	$(PYTHON) $(SETUP_SCRIPT)

# Setup target (alias for install)
setup: install
	@echo "STT setup complete! Checkpoints in $(CHECKPOINT_DIR)"

# Remove checkpoints (for clean reinstall)
clean:
	@echo "Cleaning STT checkpoints..."
	rm -rf $(CHECKPOINT_DIR)
	@echo "Cleaned."

# Run a test WAV through the engine
test:
	@if [ ! -f "$(TEST_WAV)" ]; then \
		echo "Test WAV file not found: $(TEST_WAV)"; \
	else \
		$(PYTHON) stt_engine.py $(TEST_WAV); \
	fi
